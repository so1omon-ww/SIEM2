rules:
  - name: "critical_process_detection"
    type: "immediate"
    description: "–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤"
    severity: "critical"
    category: "process"
    tags: ["critical", "process", "malware"]
    
    # –£—Å–ª–æ–≤–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è
matches:
  - field: "event_type"
    operator: "eq"
    value: "process.start"
  - field: "details.process_name"
    operator: "in"
    value: ["cmd.exe", "powershell.exe", "wscript.exe", "cscript.exe", "rundll32.exe"]
    
    # –î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏
    actions:
      - type: "alert"
        parameters:
          title: "Critical process started"
          description: "–ó–∞–ø—É—â–µ–Ω –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å: {details.process_name}"
        priority: 1
      
      - type: "notification"
        parameters:
          title: "Critical process"
          message: "–ó–∞–ø—É—â–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å {details.process_name} —Å IP {src_ip}"
          template: "critical_process"
        priority: 1
      
      - type: "log"
        parameters:
          message: "Critical process started: {details.process_name}"
          level: "critical"
        priority: 1

  - name: "suspicious_network_activity"
    type: "immediate"
    description: "–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π —Å–µ—Ç–µ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"
    severity: "medium"
    category: "network"
    tags: ["suspicious", "network", "exfiltration"]
    
    # –£—Å–ª–æ–≤–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è
    match:
      event_type: "net.connection"
      details.dst_port: [22, 23, 3389, 5900, 8080, 8443]
      details.bytes_sent: ">1000000"  # 1MB
    
    # –î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏
    actions:
      - type: "alert"
        parameters:
          title: "[WARNING] –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Å–µ—Ç–µ–≤–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"
          description: "–ë–æ–ª—å—à–æ–π –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ä—Ç {details.dst_port}"
        priority: 2
      
      - type: "notification"
        parameters:
          title: "[WARNING] –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Å–µ—Ç—å"
          message: "–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ø–æ—Ä—Ç {details.dst_port}"
          template: "suspicious_network"
        priority: 2
      
      - type: "log"
        parameters:
          message: "Suspicious network activity detected"
          level: "warning"
        priority: 3

  - name: "multiple_failed_logins"
    type: "threshold"
    description: "–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞"
    severity: "medium"
    category: "authentication"
    tags: ["brute_force", "authentication", "attack"]
    
    # –£—Å–ª–æ–≤–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è
    match:
      event_type: "auth.failure"
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ threshold –ø—Ä–∞–≤–∏–ª–∞
    window: "5m"
    threshold: 3
    group_by: ["src_ip", "details.username"]
    dedup_key: "failed_login_{src_ip}_{details.username}"
    
    # –î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏
    actions:
      - type: "alert"
        parameters:
          title: "üîí –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞"
          description: "IP {src_ip} —Å–æ–≤–µ—Ä—à–∏–ª {count} –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {details.username}"
        priority: 2
      
      - type: "notification"
        parameters:
          title: "üîí –ù–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞"
          message: "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å {src_ip}"
          template: "auth_failure"
        priority: 3
      
      - type: "log"
        parameters:
          message: "Multiple failed logins detected from {src_ip}"
          level: "warning"
        priority: 4

  - name: "normal_network_activity"
    type: "immediate"
    description: "–û–±—ã—á–Ω–∞—è —Å–µ—Ç–µ–≤–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"
    severity: "low"
    category: "network"
    tags: ["normal", "network", "monitoring"]
    
    # –£—Å–ª–æ–≤–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è - –æ–±—ã—á–Ω—ã–µ HTTP/HTTPS –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    match:
      event_type: "net.connection"
      dst_port: [80, 443]
    
    # –î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏
    actions:
      - type: "alert"
        parameters:
          title: "[INFO] –û–±—ã—á–Ω–∞—è —Å–µ—Ç–µ–≤–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"
          description: "–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–µ–±-—Å–µ—Ä–≤–∏—Å—É –Ω–∞ –ø–æ—Ä—Ç {dst_port}"
        priority: 4
      
      - type: "log"
        parameters:
          message: "Normal web traffic detected to port {dst_port}"
          level: "info"
        priority: 5

  - name: "dns_activity"
    type: "immediate"
    description: "DNS –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"
    severity: "low"
    category: "network"
    tags: ["dns", "network", "normal"]
    
    # –£—Å–ª–æ–≤–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è - DNS –∑–∞–ø—Ä–æ—Å—ã
    match:
      event_type: "net.connection"
      dst_port: 53
    
    # –î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏
    actions:
      - type: "alert"
        parameters:
          title: "[NET] DNS –∑–∞–ø—Ä–æ—Å"
          description: "–û–±–Ω–∞—Ä—É–∂–µ–Ω DNS –∑–∞–ø—Ä–æ—Å —Å {src_ip} –Ω–∞ {dst_ip}"
        priority: 5
      
      - type: "log"
        parameters:
          message: "DNS query detected from {src_ip}"
          level: "info"
        priority: 6
